@using Application.Schema.BudgetTracking.Models
@using Components.Shared
@using Microsoft.Extensions.Logging
@page "/budget-tracker"
@inherits StatefulComponent
@inject AppBudgetTracking.GetTransaction.IHandler GetTransactionHandler
@inject ILogger<Tracker> Logger

<TransactionGrid Data="@data" CurrentMonth="@CurrentMonth" />

@code {
	List<TransactionInfo> data = [];
	int CurrentMonth => DateTime.Now.Month;

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();

		// initialize
		var result = await GetTransactionHandler.DoAsync(new(State.Year.ToString(), CurrentMonth.ToString()))
						.ConfigureAwait(false);
		if (result.IsFailure)
		{
			if (Logger.IsEnabled(LogLevel.Error))
				Logger.LogError("Failed to fetch transactions of {Year} and {Month}: {Error}", State.Year, DateTime.Now.Month, result.Error);
			Notifier.Notify(Radzen.NotificationSeverity.Error, NotificationMessages.TransactionFetchFailed);
			return;
		}
		data = result.Value;
	}
}
