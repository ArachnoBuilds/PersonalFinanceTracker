@using Application.Shared.Models
@using BudgetTracking = Application.Features.BudgetTracking
@using Components.BudgetTracking.Models
@using Components.Shared
@using Microsoft.Extensions.Logging
@page "/budget-tracker"
@inherits StatefulComponent
@inject BudgetTracking.GetTransaction.Handler GetTransactionHandler
@inject ILogger<Tracker> Logger

<TransactionGrid Data="@data" />

@code {
	List<Transaction> data = [];

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();

		// initialize
		var result = await GetTransactionHandler.DoAsync(new(State.Year.ToString(), DateTime.Now.Month.ToString()))
						.ConfigureAwait(false);
		if (result.IsFailure)
		{
			if (Logger.IsEnabled(LogLevel.Error))
				Logger.LogError("Failed to fetch transactions of {Year} and {Month}: {Error}", State.Year, DateTime.Now.Month, result.Error);
			Notifier.Notify(Radzen.NotificationSeverity.Error, NotificationMessages.TransactionFetchFailed);
			return;
		}
		data = [.. result.Value.Select(p => p.ToTransaction())];
	}
}
